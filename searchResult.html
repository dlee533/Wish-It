<!DOCTYPE html>
<html lang="en">

<head>
    <title>Bootstrap 4 Website Example</title>
    <meta charset="utf-8">


    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>WishIt</title>
    <script src="https://www.gstatic.com/firebasejs/7.4.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.4.0/firebase-firestore.js"></script>
    <script src="firebaseConfig.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <link rel='stylesheet' type='text/css' href="style.css">

    <link rel='stylesheet' type='text/css' href="mainCSS.css">

</head>

<body>

    <body>
        <!-- header -->
        <nav class="navbar navbar-expand-lg navbar-dark">
            <div class="container">
                <a class="navbar-brand" href="index.html">WishIt</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
                    aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item active">
                            <a class="nav-link" href="#">My Profile</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link log">Log-in</a>
                            <!--change the text when the user signs in -->
                        </li>
                    </ul>
                </div>
            </div>
        </nav>


        <!-- search bar-->
        <div class='container'>
            <div class="form-inline center col-12 col-sm-10 col-md-8 col-lg-6">
                <select class="browser-default custom-select col-2 dropdownMenu">
                    <option selected value="user">User</option>
                    <option value="item">Item</option>
                </select>
                <input class="form-control col-8 search-bar" type="text" placeholder="Search" aria-label="Search">
                <button type='submit' class='btn search-btn col-2'>Search</button>
            </div>
        </div>

        <!-- search result-->
        <div class="jumbotron">
            <div class="card col-12 col-lg-6">
                <div class="card-body">
                    <img src="#" alt="result">
                    <p class="result_info" id="resultInfoLabel">Results:</p>
                    <div class="result_list" id="results">
                        <!--create search block elements with JS-->
                        <div>
                            <img />
                            <p id="name"></p>
                            <p id="price"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    </body>
    <script>
        let db = firebase.firestore();
        let queryStringURL = decodeURIComponent(window.location.search);
        let tempVar = queryStringURL.split('?');
        let passedValue = tempVar[1];
        tempVar = passedValue.split('=');
        let selectionType = tempVar[0].toLowerCase();
        let searchValue = tempVar[1].toLowerCase();
        console.log('HELLO', selectionType, typeof(selectionType), searchValue, typeof(searchValue));

        if (String(selectionType) === "users") {
            queryUsersResults();
        } else {
            queryItemsResults();
        }
        function queryUsersResults() {
            db.collection("users").orderBy('display_name').startAt(searchValue).endAt(searchValue+'\uf8ff').limit(10).get().then(function(querySnapshot) {
                querySnapshot.forEach(function(doc) {
                    
                });
            });
        }
        function queryItemsResults() {
            db.collection("items").orderBy('__name__').startAt(searchValue).endAt(searchValue+'\uf8ff').limit(10).get().then(function(querySnapshot) {
                querySnapshot.forEach(function(doc) {
                    console.log(doc.data());
                });
            });
        }
        function createItemBlockResult(name, data) {
            divElem = document.createElement("DIV");
            imgElem = document.createElement("IMG");
            pElemName = document.createElement("P");
            pElemPrice = document.createElement("P");
            parentDiv = document.getElementById("results");
            parentDiv.appendChild(divElem);
            divElem.appendChild(imgElem);
            divElem.appendChild(pElemName);
            divElem.appendChild(pElemPrice);
            imgElem.setAttribute("SRC", data.img_src);
            pElemName.innerHTML = name;
            pElemPrice.innerHTML = '$' + data.price;
        }
        
    </script>

</html>